<!doctype html><html lang=en-us><head><meta charset=utf-8><title>编码风格: ESLint 和 Prettier 如何在 VS Code 配合工作?</title><meta name=description content><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml href=https://blog.isayme.org/index.xml title="BLOG - ISAYME"><meta name=twitter:card content="summary"><meta name=twitter:title content="编码风格: ESLint 和 Prettier 如何在 VS Code 配合工作?"><meta name=twitter:description content="信息可能会有时效性, 当前相关工具版本信息: VS Code: 1."><link rel=stylesheet href=https://blog.isayme.org/fontawesome/css/all.min.css><link crossorigin=anonymous href=/css/styles.min.css integrity rel="preload stylesheet" as=style><link rel=stylesheet href=https://blog.isayme.org/css/custom.css><link id=dark-mode-theme crossorigin=anonymous href=/css/dark.min.css integrity rel="preload stylesheet" as=style><script>var darkTheme=document.getElementById('dark-mode-theme')
var storedTheme=localStorage.getItem('dark-mode-storage')
if(storedTheme==='dark'){darkTheme.disabled=false}else if(storedTheme==='light'){darkTheme.disabled=true}</script><script defer crossorigin=anonymous src=/js/theme.js integrity></script><script defer crossorigin=anonymous src=/js/instantpage.min.js integrity></script><meta name=generator content="Hugo 0.78.1"></head><body><header><nav class=navbar><div class=nav><ul class=nav-links></ul></div></nav><div class=intro-header><div class=container><div class=posts-heading><h1>编码风格: ESLint 和 Prettier 如何在 VS Code 配合工作?</h1></div></div></div></header><div class=container role=main><article class=article class=blog-post><blockquote><p>信息可能会有时效性, 当前相关工具版本信息: VS Code: 1.49.1, ESLint 插件: 2.1.8 , Prettier 插件: 5.7.1</p></blockquote><h1 id=vs-code-提供的能力>VS Code 提供的能力</h1><h2 id=1-文件保存时执行特定动作action>1. 文件保存时执行特定动作(action)</h2><p>1.23 版本加入的新特性 <a href=https://code.visualstudio.com/updates/v1_23#_run-code-actions-on-save>Run Code Actions on save</a>. 可以配置在文件保存时执行的动作.</p><pre><code>&quot;editor.codeActionsOnSave&quot;: {
     &quot;source.organizeImports&quot;: true // 这里是需要执行的动作.
}
</code></pre><p>这个配置在 1.41 版本 <a href=https://code.visualstudio.com/updates/v1_41#_eslint>更新</a>, 加强 ESLint的<code>Auto Fix on Save</code>能力.</p><pre><code>    &quot;editor.codeActionsOnSave&quot;: {
        &quot;source.fixAll.eslint&quot;: true
    }
</code></pre><h2 id=2-文件保存时自动格式化文件format>2. 文件保存时自动格式化文件(format)</h2><p>VS Code 1.6 版本加入的特性: <a href=https://code.visualstudio.com/updates/v1_6#_format-on-save>Format On Save</a>. 可以在文件保存是格式化文件.</p><pre><code>// 通过如下配置项开启.
&quot;editor.formatOnSave&quot;: true
</code></pre><h1 id=prettier-提供的能力>Prettier 提供的能力</h1><p><a href=https://prettier.io/>Prettier</a> 本身是一个格式化工具, 通过 <a href="https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode">插件</a> 集成到 VS Code.</p><p>Prettier 将自己注册为 VS Code 格式化(formatter) 工具, 在 VS Code <code>formatOnSave</code> 保存时格式化文件.</p><h1 id=eslint-提供的能力>ESLint 提供的能力</h1><p><a href=https://eslint.org/>ESLint</a> 主要是编码质量的检测工具, 也可以有编码质量检测, 提供风格修正(fix)能力. 通过 <a href="https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint">插件</a> 集成到 VS Code.</p><p>ESLint 将注册 <code>codeActionsOnSave</code> 能力到 VS Code, 从而可以配置在 <code>codeActionsOnSave</code> 期间格式化代码.</p><h1 id=vs-code-中-eslint-与-prettier-插件并存>VS Code 中 ESLint 与 Prettier 插件并存</h1><p>如果 VSCode 同时安装了 ESLint 和 Prettier 插件.</p><p>当 <code>formatOnSave</code> 和 <code>codeActionsOnSave</code> 都开启时, 保存文件会先后触发 ESLint 和 Prettier 格式化, 最终格式化会以 Prettier 风格为准.</p><p>如果自定义风格与 Prettier 冲突的风格, 将无法生效. 比如ESLint 配置项 <code>space-before-function-paren</code> 期望函数左括号前面空一格, 但 Prettier 期望不空格. 按照 ESLint 和 Prettier 的执行顺序, 最终会格式化为无空格.</p><h2 id=忍痛禁用特定文件的-prettier-格式化>忍痛禁用特定文件的 prettier 格式化</h2><p>不愿意删除 Prettier 插件时, 如果 Prettier 的格式化风格不符合期望, 可以配置将其禁用, 增加 <code>.prettierignore</code> 文件指定需要忽略的文件.</p><h2 id=在-prettier-之后执行-eslint---fix->在 <code>prettier</code> 之后执行 <code>eslint --fix</code> ?</h2><p>直接禁用 Prettier 还是比较粗暴, 如果能实现 <code>prettier</code> 之后执行 <code>eslint --fix</code> 也是可以解决问题的.</p><p>VS Code 1.44 版本 <a href=https://code.visualstudio.com/updates/v1_44#_explicit-ordering-for-code-actions-on-save>Explicit ordering for Code Actions on save</a> 支持将 <code>editor.codeActionsOnSave</code> 配置为数组, 按顺序执行其中的动作.</p><p>如果 Prettier 将自己注册为其中的动作, 则可以配置运行顺序. 目前已经有开发者向 Prettier 建议 <a href=https://github.com/prettier/prettier-vscode/issues/1555>Add code action to format with prettier in codeActionsOnSave in VS Code</a>.</p><p>在 Prettier 插件不改变的情况下, 还有一种<a href=https://github.com/prettier/prettier-vscode/issues/1277#issuecomment-621175180>思路</a>: 关闭<code>editor.formatOnSave</code>, 将其注册为<code>editor.codeActionsOnSav</code>动作, 可以达到同样的效果. 目前插件 <a href="https://marketplace.visualstudio.com/items?itemName=rohit-gohri.format-code-action">Format Code Action</a> 已经实现此功能.</p><p><code>eslint-config-prettier</code> 会注册自己的规则到 ESLint, 会继续按照自己的风格提示错误信息, 与自定义的风格冲突, 可以不使用<code>eslint-plugin-prettier</code>, 只在 ESLint 中使用 <code>eslint-config-prettier</code>: 关闭 Prettier 相关规则, 不提示 Prettier 风格问题, 保存时由<code>Prettier</code>自动修复风格问题即可.</p><h1 id=项目中-eslint-与-prettier-配置>项目中 ESLint 与 Prettier 配置</h1><p>由于 Prettier 的配置会与 ESLint 的冲突, 为了方便使用, Prettier 官方提供 <a href=https://github.com/prettier/eslint-config-prettier>eslint-config-prettier</a> 将冲突的 ESLint 配置项(如<code>space-before-function-paren</code>)全部关闭.</p><p>由于冲突的配置项被关闭, 相关的编码风格将不在检测, 为了继续检测这些风格, Prettier 提供 ESLint 插件 <a href=https://github.com/prettier/eslint-plugin-prettier>eslint-plugin-prettier</a> 注册规则(rule) <code>prettier/prettier</code> 到 ESLint, 开启这个规则后即可通过 ESLint 检测 Prettier 风格问题.</p><h2 id=配置-prettier-到-eslint>配置 Prettier 到 ESLint</h2><p>安装依赖 <code>npm install --save-dev eslint-config-prettier eslint-plugin-prettier</code>
修改 ESLint 配置:</p><pre><code>// .eslintrc
{
  &quot;extends&quot;: [&quot;plugin:prettier/recommended&quot;]
}

// 上面的配置方式和下面这个写法效果等同: https://github.com/prettier/eslint-plugin-prettier#recommended-configuration
{
  &quot;extends&quot;: [&quot;prettier&quot;],
  &quot;plugins&quot;: [&quot;prettier&quot;],
  &quot;rules&quot;: {
    &quot;prettier/prettier&quot;: &quot;error&quot;
  }
}
</code></pre></article></div><footer><div class=social-icons></div><div class=container><p class="credits copyright"><a href=https://blog.isayme.org/about></a>&nbsp;&copy;
2024
&nbsp;/&nbsp;
<a href=https://blog.isayme.org/>BLOG - ISAYME</a>
&nbsp;&ndash;&nbsp;
<em class="fas fa-moon" id=dark-mode-toggle></em></p><p class="credits theme-by">Powered By <a href=https://gohugo.io>Hugo</a>&nbsp;
Theme
<a href=https://github.com/matsuyoshi30/harbor>Harbor</a></p></div></footer></body></html>