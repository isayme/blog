<!doctype html><html lang=en-us><head><meta charset=utf-8><title>HTTP API 的数据校验</title><meta name=description content><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml href=https://blog.isayme.org/index.xml title="BLOG - ISAYME"><meta name=twitter:card content="summary"><meta name=twitter:title content="HTTP API 的数据校验"><meta name=twitter:description content="HTTP API 的数据校验 当提供API服务时, 本着不信任调用方的输入(参数)原则, 通常都需要对输入进行校验."><link rel=stylesheet href=https://blog.isayme.org/fontawesome/css/all.min.css><link crossorigin=anonymous href=/css/styles.min.css integrity rel="preload stylesheet" as=style><link rel=stylesheet href=https://blog.isayme.org/css/custom.css><link id=dark-mode-theme crossorigin=anonymous href=/css/dark.min.css integrity rel="preload stylesheet" as=style><script>var darkTheme=document.getElementById('dark-mode-theme')
var storedTheme=localStorage.getItem('dark-mode-storage')
if(storedTheme==='dark'){darkTheme.disabled=false}else if(storedTheme==='light'){darkTheme.disabled=true}</script><script defer crossorigin=anonymous src=/js/theme.js integrity></script><script defer crossorigin=anonymous src=/js/instantpage.min.js integrity></script><meta name=generator content="Hugo 0.78.1"></head><body><header><nav class=navbar><div class=nav><ul class=nav-links></ul></div></nav><div class=intro-header><div class=container><div class=posts-heading><h1>HTTP API 的数据校验</h1></div></div></div></header><div class=container role=main><article class=article class=blog-post><h1 id=http-api-的数据校验>HTTP API 的数据校验</h1><p>当提供API服务时, 本着不信任调用方的输入(参数)原则, 通常都需要对输入进行校验.</p><h2 id=对数据校验的期望>对数据校验的期望</h2><h3 id=类型校验>类型校验</h3><p>基本需求. 要求是数字, 就不能提供一个字符串.</p><h3 id=可选校验>可选校验</h3><p>有的参数是必须的, 有的参数是可选的.</p><h3 id=多样能力>多样能力</h3><p>有些场景某个参数同时支持两个不同类型的取值. 如果任务截止时间可能是一个字符串日期, 也可能是空(null, 表达无截止时间).</p><h3 id=格式校验>格式校验</h3><p>主要体现在提供多样的维度限制特定类型字段取值.</p><h4 id=字符串>字符串</h4><ul><li>区分 url / email / ip 等常见字符串字段的格式差异;</li><li>限制字符串长度范围;</li><li>限定字符串取值范围(enum);</li><li>通过正则表达式限制格式;</li></ul><h4 id=数字>数字</h4><ul><li>区分 整数/浮点数 的不同;</li><li>限制数字的取值范围: 最大/最小;</li><li>限定数字的取值范围(enum);</li></ul><h4 id=数组>数组</h4><ul><li>限制元素个数;</li><li>限制元素值唯一: 不可以有重复的值;</li><li>限制单个元素的类型;</li></ul><h4 id=对象>对象</h4><ul><li>限制对象属性个数范围;</li><li>指定必要的属性;</li></ul><h3 id=依赖校验>依赖校验</h3><p>两个字段有依赖关系, 比如 字段A存在时, 字段B也必须存在.</p><h3 id=默认值>默认值</h3><p>如果某个字段未提供, 则赋予默认值. 特别是 bool 字段, 语言层面通常默认都是 false, 但API层有可能需要字段未提供时默认为 true.</p><h3 id=类型尝试转换>类型(尝试)转换</h3><p>HTTP API 可以通过 query/body 传参数, 其中 body 又有 form 和 json 两种.</p><p>对于 query 和 form, 如果某个字段是 bool 类型, 当服务端收到数据时, 协议层面无法正常区分出客户端到底是想传入 bool 类型的 false/true 还是字符串类型的 false/true.</p><p>有些服务端期望支持客户端多样化的参数输入(参数可以通过query/form/json任意方式传入), 此时就需要类型转换能力.</p><h3 id=订制能力>订制能力</h3><p>实际的业务场景对于参数的验证需求各种各样, 有一定的订制能力会解决一些非典型需求.</p><h2 id=json-schema>JSON schema</h2><blockquote><p><a href=https://json-schema.org/>JSON Schema</a> is a vocabulary that allows you to <code>annotate</code> and <code>validate</code> JSON documents.</p></blockquote><p>为了解决参数校验的问题, JSON Schema 制定了一套标准, 目前最新版本是 草案7.</p><h3 id=实现>实现</h3><p>官网列举了当前各种语言的实现: <a href=https://json-schema.org/implementations.html>Implementations | JSON Schema</a></p><h2 id=如何使用>如何使用</h2><p>JSON Schema 官网的教程 <a href=https://json-schema.org/learn/>Learn | JSON Schema</a>.</p></article></div><footer><div class=social-icons></div><div class=container><p class="credits copyright"><a href=https://blog.isayme.org/about></a>&nbsp;&copy;
2024
&nbsp;/&nbsp;
<a href=https://blog.isayme.org/>BLOG - ISAYME</a>
&nbsp;&ndash;&nbsp;
<em class="fas fa-moon" id=dark-mode-toggle></em></p><p class="credits theme-by">Powered By <a href=https://gohugo.io>Hugo</a>&nbsp;
Theme
<a href=https://github.com/matsuyoshi30/harbor>Harbor</a></p></div></footer></body></html>